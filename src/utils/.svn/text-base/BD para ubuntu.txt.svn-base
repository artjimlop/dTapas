/*MODELO FISICO:
--------------*/

/*DROPS
--------*/
DROP TABLE usercomments;
DROP TABLE taparoutecomments;
DROP TABLE establishmentcomments;
DROP TABLE productcomments;
DROP TABLE comments;
DROP TABLE taparouteestablishments;
DROP TABLE taparouteusers;
DROP TABLE taparoutes;
DROP TABLE establishmentscores;
DROP TABLE productscores;
DROP TABLE others;
DROP TABLE wines;
DROP TABLE beers;
DROP TABLE meals;
DROP TABLE products;
DROP TABLE establishments;
DROP TABLE followers;
DROP TABLE users;


/*Users: 
-------------------- */

CREATE TABLE users (

	name			VARCHAR(50) NOT NULL,
	surnames		VARCHAR(150) NOT NULL,
	login			VARCHAR(15) NOT NULL UNIQUE,
	password		VARCHAR(31) NOT NULL,
	email			VARCHAR(100) NOT NULL UNIQUE,
	registryDate		DATE NOT NULL,
	USOID			VARCHAR(64) PRIMARY KEY
);

/*Seguidores: 
------------------- */

CREATE TABLE followers(

	FOLLOWOID		VARCHAR(64) PRIMARY KEY,
	FK_USEROID		VARCHAR(64) NOT NULL,
	FK_FOLLOWEDOID		VARCHAR(64) NOT NULL,
	UNIQUE(FK_USEROID,FK_FOLLOWEDOID),
	FOREIGN KEY (FK_USEROID) 	REFERENCES users(USOID) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (FK_FOLLOWEDOID) REFERENCES users(USOID) ON DELETE CASCADE ON UPDATE CASCADE	
);
		
	

/*ESTABLECIEMIENTO:
-------------------*/

CREATE TABLE establishments(

		
	nameEstablishment	VARCHAR(50) NOT NULL,
	city			VARCHAR(50) NOT NULL,
	province		VARCHAR(50) NOT NULL,
	zone			VARCHAR(50) NOT NULL,
	street			VARCHAR(50),
	zipCode			NUMERIC(5),
	registryDate		DATE NOT NULL,
	ESTOID			VARCHAR(64) PRIMARY KEY,
	establishmentID		INT NOT NULL,
	FK_USOID		VARCHAR(64),
	FOREIGN KEY (FK_USOID) 	REFERENCES users(USOID) ON DELETE SET NULL

);

	
/*PRODUCTO:
-------------------*/

CREATE TABLE products(
		
	productName		VARCHAR(50) NOT NULL,
	registryDate		DATE NOT NULL,
	price			NUMERIC(5,2) NOT NULL CHECK (precio>0),
	PRODOID			VARCHAR(64) PRIMARY KEY,
	FK_USOID		VARCHAR(64),
	FK_ESTOID		VARCHAR(64) NOT NULL,
	productID		INT NOT NULL ,
	FOREIGN KEY (FK_USOID) 	REFERENCES users(USOID) ON DELETE SET NULL,
	FOREIGN KEY (FK_ESTOID) REFERENCES establishments(ESTOID) ON DELETE CASCADE ON UPDATE CASCADE
);

/*Comida: falla el  NOT NULL CHECK (tipo IN('Tapa','Ración','1/2 Ración','Plato','Postre'))
-------------------*/

CREATE TABLE meals(
		
	type			VARCHAR(20),
	MEALOID			VARCHAR(64) PRIMARY KEY,
	FK_PRODOID		VARCHAR(64) NOT NULL,
	foodID			INT NOT NULL ,
	FOREIGN KEY (FK_PRODOID) REFERENCES products(PRODOID) ON DELETE CASCADE ON UPDATE CASCADE
);

/*Cerveza:
-------------------*/

CREATE TABLE beers(
		
	size			VARCHAR(20) NOT NULL CHECK (tamaño IN('Caña','Jarra','Tubo','Botellin','Tercio')),
	label			VARCHAR(20) NOT NULL,
	colour			VARCHAR(20) NOT NULL CHECK (color IN('Negra','Rubia','Roja')),
	temperature		VARCHAR(20) NOT NULL CHECK (temperatura IN('Muy Fría','Fría','Normal')),
	BEEROID			VARCHAR(64) PRIMARY KEY,
	beerID			INT NOT NULL ,
	FK_PRODOID		VARCHAR(64) NOT NULL,
	FOREIGN KEY (FK_PRODOID) REFERENCES products(PRODOID) ON DELETE CASCADE ON UPDATE CASCADE
);


/*Vino:
-------------------*/

CREATE TABLE wines(
		
	type			VARCHAR(20) NOT NULL,
	od			VARCHAR(20) NOT NULL,
	year			NUMERIC(4),
	growUpTime		VARCHAR(20) CHECK (growUpTime IN('Joven','Crianza','Reserva','Gran Reserva',NULL)),
	label			VARCHAR(20),
	WINEOID			VARCHAR(64) PRIMARY KEY,
	wineID			INT NOT NULL ,
	FK_PRODOID		VARCHAR(64) NOT NULL,
	FOREIGN KEY (FK_PRODOID) REFERENCES products(PRODOID) ON DELETE CASCADE ON UPDATE CASCADE
);

/*OTROS:
-------------------*/

CREATE TABLE others(
	
	size			VARCHAR(20) NOT NULL,	
	type			VARCHAR(20) NOT NULL,
	OTHEROID		VARCHAR(64) PRIMARY KEY,
	otherID			INT NOT NULL ,
	FK_PRODOID		VARCHAR(64) NOT NULL,
	FOREIGN KEY (FK_PRODOID) REFERENCES products(PRODOID) ON DELETE CASCADE ON UPDATE CASCADE
);

/*PRODUCTO-PUNTUACION:
----------------------*/

CREATE TABLE productscores (

	mediumScore		 NUMERIC(3,1) NOT NULL CHECK (mediumScore BETWEEN 0 AND 10),
	presentationScore	 NUMERIC(3,1) NOT NULL CHECK (presentationScore BETWEEN 0 AND 10),
	quantityScore		 NUMERIC(3,1) NOT NULL CHECK (quantityScore BETWEEN 0 AND 10),
	priceScore		 NUMERIC(3,1) NOT NULL CHECK (priceScore BETWEEN 0 AND 10),
	scoreDate		 DATE NOT NULL,
	scoreTime		 TIME NOT NULL,
	PRODSCOREOID		 VARCHAR(64) PRIMARY KEY,
	productScoreID		 INT NOT NULL ,
	FK_USOID		 VARCHAR(64) NOT NULL,
 	FK_PRODOID		 VARCHAR(64) NOT NULL,
	FOREIGN KEY (FK_USOID)   REFERENCES users(USOID) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (FK_PRODOID) REFERENCES products(PRODOID) ON DELETE CASCADE ON UPDATE CASCADE
	
);

/*Establishments-PUNTUACION:  FALLA EL  NOT NULL CHECK (notaServicio BETWEEN 0 AND 10)                  
------------------------------*/

CREATE TABLE establishmentscores (

	mediumScore		NUMERIC(3,1),
	qualityScore		NUMERIC(3,1),
	serviceScore		NUMERIC(3,1),
	cleaningScore		NUMERIC(3,1),
	sizeScore		NUMERIC(3,1),
	locationScore		NUMERIC(3,1),
	priceScore		NUMERIC(3,1),
	scoreDate		DATE NOT NULL,
	scoreTime		TIME NOT NULL,
	ESCOREOID		VARCHAR(64) PRIMARY KEY,
	establishmentScoreID	INT NOT NULL ,
	FK_USOID		VARCHAR(64) NOT NULL,
	FK_ESTOID		VARCHAR(64) NOT NULL,
	FOREIGN KEY (FK_USOID)  REFERENCES users(USOID) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (FK_ESTOID) REFERENCES establishments(ESTOID) ON DELETE CASCADE ON UPDATE CASCADE
	
);

/*RUTA-TAPA:
--------------------*/

CREATE TABLE taparoutes (
	nameRoute		VARCHAR(50) NOT NULL,
	creationRouteDate	DATE NOT NULL,
	routeDate		DATE CHECK (routeDate>=creationRouteDate),
	ROUTEOID		VARCHAR(64) PRIMARY KEY,
	tapaRouteID			INT NOT NULL ,
	FK_USOID		VARCHAR(64),
	FOREIGN KEY (FK_USOID) REFERENCES users(USOID) ON DELETE SET NULL
	
);



/*Users-RutaTAPA:
-------------------*/

CREATE TABLE taparouteusers(
		
	TRUSEROID		VARCHAR(64) PRIMARY KEY,
	tapaRouteUserID			INT NOT NULL ,
	FK_USOID		VARCHAR(64) NOT NULL,
	FK_ROUTEOID		VARCHAR(64) NOT NULL,
	FOREIGN KEY (FK_USOID) 	REFERENCES users(USOID) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (FK_ROUTEOID) REFERENCES taparoutes(ROUTEOID) ON DELETE CASCADE ON UPDATE CASCADE
);


/*Establishments-RutaTAPA:          
----------------------------*/

CREATE TABLE taparouteestablishments(
		
	TRESTOID		VARCHAR(64) PRIMARY KEY,
	tapaRouteEstablishmentID			INT NOT NULL ,
	FK_ESTOID		VARCHAR(64) NOT NULL,
	FK_ROUTEOID		VARCHAR(64) NOT NULL,
	FOREIGN KEY (FK_ESTOID) REFERENCES establishments(ESTOID) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (FK_ROUTEOID) REFERENCES taparoutes(ROUTEOID) ON DELETE CASCADE ON UPDATE CASCADE
);



/*COMENTARIO 
--------------------------------------*/	

CREATE TABLE comments(

	commentarie 	VARCHAR(500) NOT NULL,
	commentDate	DATE NOT NULL,
	commentTime	TIME NOT NULL,
	COMOID		VARCHAR(64) PRIMARY KEY,
	commentID	INT NOT NULL ,	
	FK_USOID	VARCHAR(64) NOT NULL,
	FOREIGN KEY (FK_USOID) REFERENCES users(USOID) ON DELETE CASCADE ON UPDATE CASCADE

);





/*COMENTARIO Producto
--------------------------------------*/	

CREATE TABLE productcomments(

	COMPROID	VARCHAR(64) PRIMARY KEY,
	productCommentID			INT NOT NULL ,	
	FK_COMOID	VARCHAR(64) NOT NULL,
	FK_PRODOID	VARCHAR(64) NOT NULL,
	FOREIGN KEY (FK_COMOID) REFERENCES comments(COMOID) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (FK_PRODOID) REFERENCES products(PRODOID) ON DELETE CASCADE ON UPDATE CASCADE

);




/*COMENTARIO Establishments
--------------------------------------*/	

CREATE TABLE establishmentcomments(

	COMNTESTOID	VARCHAR(64) PRIMARY KEY,
	establishmentCommentID			INT NOT NULL ,	
	FK_COMOID	VARCHAR(64) NOT NULL,
	FK_ESTOID	VARCHAR(64) NOT NULL,
	FOREIGN KEY (FK_COMOID) REFERENCES comments(COMOID) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (FK_ESTOID) REFERENCES establishments(ESTOID) ON DELETE CASCADE ON UPDATE CASCADE

);

/*COMENTARIO taparoutecomments
--------------------------------------*/	

CREATE TABLE taparoutecomments(


	TRCOID		VARCHAR(64) PRIMARY KEY,
	tapaRouteCommentID			INT NOT NULL ,	
	FK_COMOID	VARCHAR(64) NOT NULL,
	FK_ROUTEOID	VARCHAR(64) NOT NULL,
	FOREIGN KEY (FK_COMOID) REFERENCES comments(COMOID) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (FK_ROUTEOID) REFERENCES taparoutes(ROUTEOID) ON DELETE CASCADE ON UPDATE CASCADE

);

/*COMENTARIO usercomments
--------------------------------------*/

CREATE TABLE usercomments(
	UCOID		VARCHAR(64) PRIMARY KEY,
	userCommentID	INT NOT NULL ,	
	FK_USEROID	VARCHAR(64) NOT NULL,
	FK_COMOID	VARCHAR(64) NOT NULL,
	FOREIGN KEY (FK_USEROID) REFERENCES users(USOID) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (FK_COMOID) REFERENCES comments(COMOID) ON DELETE CASCADE ON UPDATE CASCADE

);